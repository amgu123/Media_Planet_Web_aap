<div class="row mb-4 animate__animated animate__fadeIn">
    <div class="col">
        <h4 class="fw-bold mb-1">Generated Content</h4>
        <p class="text-muted">View and filter detection results from all background services.</p>
    </div>
</div>

<!-- Filters Bar -->
<div class="card border-0 shadow-sm mb-4 animate__animated animate__fadeInDown">
    <div class="card-body p-4">
        <form [formGroup]="filterForm" (ngSubmit)="onFilter()" class="row g-3">
            <div class="col-md-4">
                <label class="form-label small fw-bold">Channel</label>
                <select formControlName="channelId" class="form-select border-light-subtle">
                    <option value="">All Channels</option>
                    <option *ngFor="let channel of channels" [value]="channel.id">{{ channel.channelName }}</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label small fw-bold">Start Date</label>
                <input type="date" formControlName="startDate" class="form-select border-light-subtle">
            </div>
            <div class="col-md-2">
                <label class="form-label small fw-bold">End Date</label>
                <input type="date" formControlName="endDate" class="form-select border-light-subtle">
            </div>
            <div class="col-md-2">
                <label class="form-label small fw-bold">Start Time</label>
                <input type="time" formControlName="startTime" class="form-select border-light-subtle">
            </div>
            <div class="col-md-2">
                <label class="form-label small fw-bold">End Time</label>
                <input type="time" formControlName="endTime" class="form-select border-light-subtle">
            </div>

            <div class="col-12 d-flex justify-content-end gap-2 mt-4">
                <button type="button" class="btn btn-light px-4" (click)="resetFilters()">
                    <i class="bi bi-arrow-counterclockwise me-2"></i> Reset
                </button>
                <button type="submit" class="btn btn-primary px-4">
                    <i class="bi bi-funnel me-2"></i> Apply Filters
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Content List -->
<div class="row g-4 animate__animated animate__fadeInUp mb-5">
    <div class="col-12" *ngIf="loading">
        <div class="text-center p-5 card border-0 shadow-sm mb-4 animate__animated animate__fadeInDown">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3 text-muted">Fetching detection results...</p>
        </div>
    </div>

    <div class="col-12" *ngIf="!loading && contents.length === 0">
        <div class="text-center p-5 bg-white rounded shadow-sm">
            <i class="bi bi-search display-1 text-light-subtle"></i>
            <h5 class="mt-3 fw-bold">No results found</h5>
            <p class="text-muted">Try adjusting your filters or enabling services.</p>
        </div>
    </div>

    <div class="col-12" *ngFor="let item of contents">
        <div class="card border-0 shadow-sm hover-elevate overflow-hidden">
            <div class="card-body p-0">
                <div class="row g-0">
                    <!-- Left Strip - Info -->
                    <div class="col-lg-3 bg-light p-4 d-flex flex-column">
                        <div class="d-flex align-items-center mb-3">
                            <span class="badge rounded-pill" [class.bg-primary-subtle]="item.taskType === 'AD'"
                                [class.text-primary]="item.taskType === 'AD'"
                                [class.bg-warning-subtle]="item.taskType === 'NEWS'"
                                [class.text-warning]="item.taskType === 'NEWS'"
                                [class.bg-info-subtle]="item.taskType === 'OCR'"
                                [class.text-info]="item.taskType === 'OCR'">
                                {{ item.taskType }}
                            </span>
                            <span class="ms-auto text-muted smallest-text">Create At : {{ item.timestamp | date:'short'
                                }}</span>
                        </div>

                        <div class="d-flex align-items-center mb-3">
                            <img *ngIf="item.channel.logo" [src]="item.channel.logo" class="rounded-circle me-3"
                                style="width: 32px; height: 32px; object-fit: cover; border: 1px solid #eee;">
                            <div>
                                <h6 class="mb-0 fw-bold">{{ item.channel.channelName }}</h6>
                                <span class="text-muted smallest-text">{{ item.channel.language?.languageName }}</span>
                            </div>
                        </div>

                        <div class="mt-auto pt-3 border-top">
                            <div class="mb-2 d-flex justify-content-between align-items-center">
                                <span class="text-muted smallest-text">Recording Timestamp:</span>
                                <span class="fw-medium smallest-text text-truncate ms-2" [title]="item.fileName">{{
                                    item.fileName || 'N/A' }}</span>
                            </div>
                            <div class="mb-3 d-flex justify-content-between align-items-center">
                                <span class="text-muted smallest-text">Recording Date:</span>
                                <span class="fw-medium smallest-text">{{ (item.dataDate | date) || 'N/A' }}</span>
                            </div>

                            <div class="d-grid gap-2">
                                <button *ngIf="item.imageUrl" class="btn btn-outline-primary btn-sm">
                                    <i class="bi bi-image me-1"></i> View Image
                                </button>
                                <button class="btn btn-primary btn-sm" (click)="toggleExpand(item.id)">
                                    <i class="bi" [class.bi-list-ul]="!isExpanded(item.id)"
                                        [class.bi-chevron-up]="isExpanded(item.id)"></i>
                                    {{ isExpanded(item.id) ? 'Hide Transcripts' : 'View Transcripts' }}
                                    <span class="badge bg-white text-primary ms-1" *ngIf="item.transcripts?.length">{{
                                        item.transcripts?.length }}</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Right Part - Content/Transcripts -->
                    <div class="col-lg-9 p-4">
                        <div *ngIf="!isExpanded(item.id)">
                            <h6 class="fw-bold mb-3 text-primary"><i class="bi bi-chat-left-text me-2"></i>Content
                                Summary</h6>
                            <div class="p-4 bg-light rounded text-dark content-box-full">
                                {{ item.content || 'Transcription data...' }}
                            </div>
                        </div>

                        <div *ngIf="isExpanded(item.id)" class="animate__animated animate__fadeIn">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="fw-bold mb-0 text-primary"><i class="bi bi-clock-history me-2"></i>Detailed
                                    Transcripts</h6>
                                <div class="input-group input-group-sm" style="width: 250px;">
                                    <span class="input-group-text bg-white border-end-0"><i
                                            class="bi bi-search text-muted"></i></span>
                                    <input type="text" class="form-control border-start-0 ps-0"
                                        placeholder="Search segments..."
                                        (input)="onSearchChange(item.id, $any($event.target).value)">
                                </div>
                            </div>
                            <div class="transcript-container rounded border">
                                <table class="table table-hover table-borderless mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th class="ps-4" style="width: 80px;">Sr. No.</th>
                                            <th style="width: 150px;">Timestamp</th>
                                            <th>Transcription Text</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let seg of getFilteredTranscripts(item); let i = index">
                                            <td class="ps-4 text-muted small">{{ i + 1 }}</td>
                                            <td>
                                                <span class="badge bg-secondary-subtle text-secondary fw-semibold">{{
                                                    seg.timeStamp }}</span>
                                            </td>
                                            <td class="text-dark">{{ seg.text }}</td>
                                        </tr>
                                        <tr *ngIf="getFilteredTranscripts(item).length === 0">
                                            <td colspan="3" class="text-center py-4 text-muted">
                                                <i class="bi bi-search me-2"></i> No matching segments found.
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Pagination Footer -->
<div class="row mb-5" *ngIf="totalPages > 1">
    <div class="col-12 d-flex justify-content-between align-items-center">
        <div class="text-muted small">
            Showing <strong>{{ currentPage * pageSize + 1 }}</strong> - <strong>{{ (currentPage + 1) * pageSize >
                totalElements ? totalElements : (currentPage + 1) * pageSize }}</strong> of <strong>{{ totalElements
                }}</strong> results
        </div>
        <nav>
            <ul class="pagination pagination-sm mb-0">
                <li class="page-item" [class.disabled]="currentPage === 0">
                    <a class="page-link" href="javascript:void(0)" (click)="onPageChange(currentPage - 1)">Previous</a>
                </li>
                <li class="page-item" *ngFor="let p of [].constructor(totalPages); let i = index"
                    [class.active]="i === currentPage">
                    <a class="page-link" href="javascript:void(0)" (click)="onPageChange(i)">{{ i + 1 }}</a>
                </li>
                <li class="page-item" [class.disabled]="currentPage === totalPages - 1">
                    <a class="page-link" href="javascript:void(0)" (click)="onPageChange(currentPage + 1)">Next</a>
                </li>
            </ul>
        </nav>
    </div>
</div>